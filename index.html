<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EcoPeace â€” Interactive Experience</title>

  <!-- Google Font (optional, widely available) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0f1720;
      --card: rgba(255,255,255,0.06);
      --accent: #56c596;
      --accent-2: #7dd3fc;
      --glass: rgba(255,255,255,0.06);
      --text: #e6eef3;
      --muted: #9db0bf;
      --success: #7dd36b;
    }
    [data-theme="light"]{
      --bg: #f6fbfa;
      --card: rgba(10,20,10,0.03);
      --accent: #2a8f6b;
      --accent-2: #0ea5e9;
      --glass: rgba(0,0,0,0.03);
      --text: #082023;
      --muted: #4b6670;
      --success: #2f9e46;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 10% 10%, rgba(86,197,150,0.06), transparent),
                  linear-gradient(180deg,var(--bg), color-mix(in srgb, var(--bg) 80%, black 10%));
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
      scroll-behavior:smooth;
    }

    header{
      position:fixed; top:12px; left:12px; right:12px;
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 18px; gap:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius:14px;
      backdrop-filter: blur(8px) saturate(1.1);
      z-index:1000;
      box-shadow: 0 6px 24px rgba(2,6,23,0.45);
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:44px; height:44px; border-radius:10px;
      display:grid; place-items:center; font-weight:700;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      color:white; box-shadow: 0 6px 18px rgba(10,10,10,0.25);
    }
    .brand h1{font-size:1rem; margin:0; letter-spacing:0.2px}
    .controls{display:flex; gap:10px; align-items:center}
    button.control{
      border:0; background:var(--card); color:var(--text);
      padding:8px 12px; border-radius:10px; font-weight:600; cursor:pointer;
    }
    button.control:focus{outline:2px solid color-mix(in srgb, var(--accent) 60%, transparent);}

    /* HERO - Canvas Globe Fullscreen */
    .hero{
      height:100vh; width:100%;
      display:grid; place-items:center; position:relative; overflow:hidden;
    }
    canvas#globe{
      width:100%; height:100%; display:block;
    }
    .hero-overlay{
      position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
      max-width:1100px; width:92%;
      display:flex; gap:24px; align-items:center; justify-content:space-between;
      padding:28px; border-radius:18px; background:linear-gradient(180deg,var(--glass), rgba(255,255,255,0.02));
      backdrop-filter: blur(8px) saturate(1.1); box-shadow:0 10px 40px rgba(2,6,23,0.5);
    }
    .hero-left{max-width:60%}
    .hero-left h2{margin:0; font-size:2rem; line-height:1.05; color:var(--text)}
    .hero-left p{color:var(--muted); margin-top:10px; font-size:1rem}
    .hero-actions{display:flex; gap:10px; margin-top:18px}
    .btn-primary{
      background:linear-gradient(90deg,var(--accent),var(--accent-2)); border:0; color:white;
      padding:10px 16px; border-radius:12px; font-weight:700; cursor:pointer;
      box-shadow: 0 8px 20px color-mix(in srgb, var(--accent) 30%, black);
    }
    .btn-ghost{background:transparent; border:1px solid rgba(255,255,255,0.06); padding:8px 12px; border-radius:12px; color:var(--text); cursor:pointer}

    /* Info cards under hero */
    .stats-row{
      position:absolute; left:50%; bottom:38px; transform:translateX(-50%);
      display:flex; gap:14px; z-index:30; width:min(1100px,92%);
    }
    .stat{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      padding:12px 18px; border-radius:12px; min-width:160px; text-align:left;
      backdrop-filter: blur(6px);
    }
    .stat h3{margin:0; font-size:1.3rem; color:var(--accent); letter-spacing:0.6px}
    .stat p{margin-top:6px; color:var(--muted); font-size:0.9rem}

    /* Sections full-screen */
    main section{
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:80px 6%;
    }
    .panel{
      width:100%; max-width:1200px; display:grid; grid-template-columns:1fr 420px; gap:36px; align-items:start;
    }
    .panel .content h2{margin:0 0 12px 0; color:var(--accent)}
    .panel .content p{color:var(--muted); line-height:1.7}
    .panel .side{
      background:var(--card); padding:20px; border-radius:14px; min-height:320px;
    }

    /* Timeline */
    .timeline{
      display:flex; flex-direction:column; gap:18px;
    }
    .slider{
      width:100%; margin-top:10px;
    }
    input[type="range"]{width:100%}

    /* Stories grid */
    .stories-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:18px}
    .story{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:12px;
    }
    .story h4{margin:0 0 8px 0; color:var(--accent-2)}
    .story p{margin:0; color:var(--muted); font-size:0.95rem}

    /* Contact */
    form.contact{display:flex; flex-direction:column; gap:10px}
    input, textarea{
      padding:10px 12px; border-radius:10px; border:0; background:transparent; color:var(--text);
      border:1px solid rgba(255,255,255,0.04);
    }
    .note{font-size:0.9rem; color:var(--muted)}

    footer{
      padding:26px 6%; text-align:center; color:var(--muted); border-top:1px solid rgba(255,255,255,0.03)
    }

    /* small screens */
    @media (max-width:980px){
      .hero-overlay{flex-direction:column; gap:12px; padding:18px}
      .hero-left{max-width:100%}
      .panel{grid-template-columns:1fr; align-items:stretch}
      .stats-row{flex-direction:column; bottom:20px}
    }
  </style>
</head>
<body>

  <header role="banner" aria-label="EcoPeace Navigation">
    <div class="brand">
      <div class="logo" aria-hidden="true">EP</div>
      <div>
        <h1>EcoPeace</h1>
        <div style="font-size:12px;color:var(--muted)">í™˜ê²½ Ã— í‰í™” â€” Interactive Experience</div>
      </div>
    </div>

    <div class="controls" role="navigation" aria-label="controls">
      <button class="control" id="theme-toggle" aria-pressed="false" title="Toggle theme">í…Œë§ˆ</button>
      <button class="control" id="plant-btn" title="Plant a Tree (Space)" aria-label="Plant a Tree">ë‚˜ë¬´ì‹¬ê¸°</button>
      <button class="control" id="jump-action">ì°¸ì—¬í•˜ê¸°</button>
    </div>
  </header>

  <!-- HERO with Canvas Globe -->
  <section class="hero" id="hero" aria-label="Hero: Interactive Globe">
    <canvas id="globe" role="img" aria-label="rotating globe visualization"></canvas>

    <div class="hero-overlay" aria-hidden="false">
      <div class="hero-left">
        <h2>ì§€êµ¬ëŠ” ìš°ë¦¬ ëª¨ë‘ì˜ ì§‘ì…ë‹ˆë‹¤.<br/><span style="color:var(--muted);font-weight:500">í™˜ê²½ê³¼ í‰í™”ëŠ” ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</span></h2>
        <p>EcoPeaceëŠ” í™˜ê²½ íŒŒê´´ê°€ ì‚¬íšŒì  ê°ˆë“±ê³¼ ì¸ê¶Œ ë¬¸ì œë¡œ ì´ì–´ì§€ëŠ” í˜„ì‹¤ì„ ë³´ì—¬ì£¼ê³ , ì²­ì†Œë…„ë“¤ì˜ ì—°ëŒ€ë¡œ ì§€ì† ê°€ëŠ¥í•œ ê¸¸ì„ ëª¨ìƒ‰í•˜ëŠ” ì¸í„°ë™í‹°ë¸Œ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
        <div class="hero-actions">
          <button class="btn-primary" id="start-plant">ë‚˜ë¬´ ì‹¬ê¸° ì‹œì‘</button>
          <button class="btn-ghost" id="learn-more">ìŠ¤í† ë¦¬ ë³´ê¸°</button>
        </div>
      </div>

      <aside style="width:320px" class="hero-right" aria-hidden="true">
        <div style="display:flex;flex-direction:column;gap:12px">
          <div style="background:linear-gradient(90deg,var(--accent),var(--accent-2)); padding:12px; border-radius:12px; color:#022; font-weight:700;">
            í™˜ê²½ê³¼ í‰í™” ì¸ë±ìŠ¤
          </div>
          <div style="background:var(--card); padding:12px; border-radius:12px;">
            <div style="font-size:13px; color:var(--muted)">ë‚˜ë¬´ ì‹¬ìŒ</div>
            <div id="trees-count" style="font-size:20px; font-weight:700; margin-top:6px">0</div>
          </div>
          <div style="background:var(--card); padding:12px; border-radius:12px;">
            <div style="font-size:13px; color:var(--muted)">ëŒ€ëµ COâ‚‚ ê°ì†ŒëŸ‰</div>
            <div id="co2-count" style="font-size:20px; font-weight:700; margin-top:6px">0.0 t</div>
          </div>
        </div>
      </aside>
    </div>

    <div class="stats-row" aria-hidden="true">
      <div class="stat">
        <h3 id="global-forest">34%</h3>
        <p>ì„¸ê³„ ìˆ² ì»¤ë²„(ì‹œë®¬ë ˆì´ì…˜)</p>
      </div>
      <div class="stat">
        <h3 id="climate-refugee">12M</h3>
        <p>ê¸°í›„ ë‚œë¯¼(ì‹œë®¬ë ˆì´ì…˜)</p>
      </div>
      <div class="stat">
        <h3 id="peace-index">72</h3>
        <p>í‰í™” ì§€ìˆ˜(ì‹œë®¬ë ˆì´ì…˜)</p>
      </div>
    </div>
  </section>

  <main>
    <!-- Connection Panel -->
    <section id="connection" aria-labelledby="conn-title">
      <div class="panel">
        <div class="content">
          <h2 id="conn-title">í™˜ê²½ì´ í‰í™”ì— ë¯¸ì¹˜ëŠ” ì˜í–¥</h2>
          <p>ë¬¼, ì‹ëŸ‰, ìì›ì´ ë¶€ì¡±í•´ì§ˆ ë•Œ ì‚¬íšŒì  ê¸´ì¥ì€ ì¦ê°€í•©ë‹ˆë‹¤. EcoPeaceëŠ” ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜ê³¼ ìŠ¤í† ë¦¬ë¥¼ í†µí•´ ê¸°í›„ë³€í™”ê°€ ì¸ê¶Œê³¼ ë¶„ìŸì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ì§€ë¥¼ ì²´í—˜ì ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.</p>

          <div style="margin-top:22px" class="timeline" aria-hidden="false">
            <label style="font-size:13px;color:var(--muted)">íƒ€ì„ë¼ì¸: <span id="year-label">2025</span></label>
            <input type="range" id="year-slider" min="1990" max="2050" step="1" value="2025" class="slider" aria-valuemin="1990" aria-valuemax="2050" />
            <div style="display:flex; gap:12px; margin-top:10px;">
              <div style="flex:1; background:var(--card); padding:12px; border-radius:10px">
                <div style="font-size:12px;color:var(--muted)">ìˆ² ë©´ì </div>
                <div id="forest-qty" style="font-weight:700; font-size:18px; margin-top:8px">34%</div>
              </div>
              <div style="flex:1; background:var(--card); padding:12px; border-radius:10px">
                <div style="font-size:12px;color:var(--muted)">ê¸°í›„ ë‚œë¯¼ ì¶”ì •</div>
                <div id="refugee-qty" style="font-weight:700; font-size:18px; margin-top:8px">12M</div>
              </div>
            </div>
          </div>
        </div>

        <aside class="side" aria-hidden="false">
          <strong style="color:var(--accent)">ì‹œë®¬ë ˆì´ì…˜ í•´ë³´ê¸°</strong>
          <p class="note" style="margin-top:8px">íƒ€ì„ë¼ì¸ì„ ì¡°ì ˆí•˜ë©´ ê°„ë‹¨í•œ ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜ ì§€í‘œë“¤ì´ ë³€í•©ë‹ˆë‹¤. ë‚˜ë¬´ë¥¼ ì‹¬ì–´ ì˜í–¥ë ¥ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
          <div style="margin-top:12px; display:flex; gap:8px">
            <button class="btn-primary" id="fast-forward">ë¯¸ë˜ë¡œ</button>
            <button class="btn-ghost" id="reset-sim">ë¦¬ì…‹</button>
          </div>
        </aside>
      </div>
    </section>

    <!-- Stories -->
    <section id="stories" aria-labelledby="stories-title">
      <div class="panel">
        <div class="content">
          <h2 id="stories-title">í˜„ì¥ì˜ ì´ì•¼ê¸°ë“¤</h2>
          <p>ì²­ì†Œë…„ë“¤ì´ ì§ì ‘ ì§„í–‰í•œ í”„ë¡œì íŠ¸ì˜ ì´ì•¼ê¸°ì™€ ì¸í„°ë·°, ì‚¬ì§„ì„ ëª¨ì•„ ì „ì‹œí•©ë‹ˆë‹¤. ì‹¤ì²œì´ ê³§ êµìœ¡ì…ë‹ˆë‹¤.</p>

          <div class="stories-grid" style="margin-top:18px">
            <article class="story" tabindex="0">
              <h4>í•´ì•ˆ ì •í™”: ì‘ì€ ì‹œì‘</h4>
              <p>í•™ìƒë“¤ì´ í•´ì•ˆê°€ì—ì„œ ì“°ë ˆê¸°ë¥¼ ìˆ˜ê±°í•˜ë©° ì§€ì—­ ì»¤ë®¤ë‹ˆí‹°ì™€ í˜‘ë ¥í•œ ì‚¬ë¡€ì…ë‹ˆë‹¤. ì§€ì†ê°€ëŠ¥í•œ ìŠµê´€ì€ ì´ë ‡ê²Œ ì‹œì‘ë©ë‹ˆë‹¤.</p>
            </article>
            <article class="story" tabindex="0">
              <h4>í‰í™”ì˜ ìˆ² ì¡°ì„±</h4>
              <p>ë¶„ìŸ í”¼í•´ ì§€ì—­ì— ë‚˜ë¬´ë¥¼ ì‹¬ì–´ ìƒíƒœë³µêµ¬ì™€ ì‹¬ë¦¬ì  ì¹˜ìœ ë¥¼ ì§€ì›í•œ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.</p>
            </article>
            <article class="story" tabindex="0">
              <h4>ê¸°í›„êµìœ¡ ì›Œí¬ìˆ</h4>
              <p>ì²­ì†Œë…„ì´ ê¸°íší•œ ì›Œí¬ìˆìœ¼ë¡œ, ì§€ì—­ ì£¼ë¯¼ê³¼ í•¨ê»˜ ê¸°í›„ìœ„ê¸°ì™€ ì¸ê¶Œì„ ë…¼ì˜í–ˆìŠµë‹ˆë‹¤.</p>
            </article>
          </div>
        </div>

        <aside class="side" aria-hidden="true">
          <strong style="color:var(--accent)">ì°¸ì—¬ì í”¼ë“œë°±</strong>
          <div style="margin-top:8px; color:var(--muted)">"í•¨ê»˜ ë‚˜ë¬´ë¥¼ ì‹¬ìœ¼ë©° ì§„ì§œ ë³€í™”ë¥¼ ëŠê¼ˆì–´ìš”." â€” ì°¸ê°€ í•™ìƒ</div>
        </aside>
      </div>
    </section>

    <!-- Action / Planting -->
    <section id="action" aria-labelledby="action-title">
      <div class="panel">
        <div class="content">
          <h2 id="action-title">ì§€ê¸ˆ, í–‰ë™í•˜ì„¸ìš”</h2>
          <p>ì—¬ê¸°ì„œëŠ” ì§ì ‘ â€˜ë‚˜ë¬´ ì‹¬ê¸°â€™ ì¸í„°ë™ì…˜ìœ¼ë¡œ ì‘ì€ ë³€í™”ë¥¼ ì²´í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™”ë©´ì˜ ì•„ë¬´ ê³³ì´ë‚˜ í´ë¦­(ë˜ëŠ” í‚¤ë³´ë“œ Space)í•˜ë©´ ë‚˜ë¬´ê°€ ì‹¬ì–´ì§‘ë‹ˆë‹¤. ë‚˜ë¬´ëŠ” COâ‚‚ë¥¼ ì¤„ì´ê³  í‰í™” ì§€ìˆ˜ì— ê¸ì •ì  ì˜í–¥ì„ ì¤ë‹ˆë‹¤ (ì‹œë®¬ë ˆì´ì…˜).</p>

          <div style="margin-top:18px">
            <div class="note">í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤: <strong>Space</strong> = ë‚˜ë¬´ ì‹¬ê¸°, <strong>T</strong> = í…Œë§ˆ í† ê¸€</div>
            <div style="height:20px"></div>
            <div style="display:flex; gap:10px">
              <button class="btn-primary" id="plant-quick">í•œë²ˆ ì‹¬ê¸°</button>
              <button class="btn-ghost" id="auto-plant">ìë™ ì‹¬ê¸° ì¼œê¸°</button>
            </div>
          </div>
        </div>

        <aside class="side" aria-hidden="false">
          <strong style="color:var(--accent)">ì—°ê²° í†µê³„</strong>
          <div style="margin-top:10px">
            <div style="font-size:12px;color:var(--muted)">í˜„ ì¬ ë‚˜ë¬´ ìˆ˜</div>
            <div id="side-trees" style="font-weight:700; font-size:24px; margin-top:6px">0</div>
            <div style="height:14px"></div>
            <div style="font-size:12px;color:var(--muted)">í‰í™” ì§€ìˆ˜ íš¨ê³¼</div>
            <div id="side-peace" style="font-weight:700; font-size:20px; margin-top:6px">+0.0</div>
          </div>
        </aside>
      </div>
    </section>

    <!-- Contact -->
    <section id="contact" aria-labelledby="contact-title">
      <div class="panel">
        <div class="content">
          <h2 id="contact-title">í•¨ê»˜ ë§Œë“¤ê¸°</h2>
          <p>í”„ë¡œì íŠ¸ ì°¸ì—¬, ì œì•ˆ, í˜‘ì—… ë¬¸ì˜ëŠ” ì•„ë˜ í¼ì„ ì´ìš©í•˜ì„¸ìš”. (ì´ ì˜ˆì‹œëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬ë§Œ í¬í•¨í•©ë‹ˆë‹¤.)</p>

          <form class="contact" id="contact-form" onsubmit="return false;" aria-label="Contact form">
            <input id="name" placeholder="ì´ë¦„" aria-label="ì´ë¦„" required />
            <input id="email" placeholder="ì´ë©”ì¼" type="email" aria-label="ì´ë©”ì¼" required />
            <textarea id="message" rows="4" placeholder="ë©”ì‹œì§€" aria-label="ë©”ì‹œì§€" required></textarea>
            <div style="display:flex; gap:10px; align-items:center">
              <button class="btn-primary" id="send-btn">ë³´ë‚´ê¸°</button>
              <div id="form-status" class="note" aria-live="polite"></div>
            </div>
          </form>
        </div>

        <aside class="side" aria-hidden="true">
          <strong style="color:var(--accent)">ëŒ€í™”ì˜ ì‹œì‘</strong>
          <p class="note" style="margin-top:8px">ê°„ë‹¨í•œ ë©”ì‹œì§€ë¡œë„ í˜‘ì—…ì´ ì‹œì‘ë©ë‹ˆë‹¤. ì €í¬ëŠ” ì²­ì†Œë…„ì˜ ëª©ì†Œë¦¬ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</p>
        </aside>
      </div>
    </section>
  </main>

  <footer role="contentinfo">
    Â© 2025 EcoPeace Project Â· ì´ í™ˆí˜ì´ì§€ì˜ ì§€ì ì†Œìœ ê¶Œì€ <strong>ì¶©ë ¬ì—¬ê³  1í•™ë…„ 1ë°˜</strong>ì—ê²Œ ìˆìŠµë‹ˆë‹¤.
  </footer>

  <script>
  /**************************************************************************
   * Interactive behaviors:
   * - Canvas globe with particles (simple rotating sphere projection)
   * - Planting interaction: click/space adds trees, updates counters
   * - Timeline slider updates simulated stats
   * - Theme toggle, keyboard shortcuts, contact form validation
   **************************************************************************/

  (function(){
    // ======= Utilities & State =======
    const state = {
      trees: 0,
      co2Saved: 0.0,     // metric tons (simulated)
      peaceBoost: 0.0,
      autoPlanting:false
    };

    // DOM refs
    const treesCount = document.getElementById('trees-count');
    const co2Count = document.getElementById('co2-count');
    const sideTrees = document.getElementById('side-trees');
    const sidePeace = document.getElementById('side-peace');
    const globalForest = document.getElementById('global-forest');
    const climateRefugee = document.getElementById('climate-refugee');
    const peaceIndex = document.getElementById('peace-index');
    const yearLabel = document.getElementById('year-label');
    const forestQty = document.getElementById('forest-qty');
    const refugeeQty = document.getElementById('refugee-qty');
    const slider = document.getElementById('year-slider');
    const themeToggle = document.getElementById('theme-toggle');
    const plantBtn = document.getElementById('plant-btn');
    const plantQuick = document.getElementById('plant-quick');
    const autoPlant = document.getElementById('auto-plant');
    const fastForward = document.getElementById('fast-forward');
    const resetSim = document.getElementById('reset-sim');
    const jumpAction = document.getElementById('jump-action');

    // ======= Canvas Globe =======
    const canvas = document.getElementById('globe');
    const ctx = canvas.getContext('2d', {alpha:true});
    let W = canvas.width = innerWidth;
    let H = canvas.height = innerHeight;
    let particles = [];
    let angle = 0;

    function onResize(){
      W = canvas.width = innerWidth;
      H = canvas.height = innerHeight;
    }
    addEventListener('resize', onResize);

    // Create particle points on sphere (latitude/longitude)
    function initParticles(){
      particles = [];
      const count = 900; // number of points
      for(let i=0;i<count;i++){
        // distribute points on sphere
        const u = Math.random();
        const v = Math.random();
        const theta = 2*Math.PI*u;
        const phi = Math.acos(2*v-1);
        // sphere coords
        const x = Math.sin(phi)*Math.cos(theta);
        const y = Math.sin(phi)*Math.sin(theta);
        const z = Math.cos(phi);
        particles.push({x,y,z});
      }
    }

    function drawGlobe(){
      ctx.clearRect(0,0,W,H);

      // subtle background glow
      const grad = ctx.createRadialGradient(W*0.7,H*0.25,10, W*0.7,H*0.25, Math.max(W,H));
      grad.addColorStop(0, "rgba(86,197,150,0.06)");
      grad.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,W,H);

      // rotate particles and project to 2D
      const cx = W/2, cy = H/2;
      const radius = Math.min(W,H)*0.28;
      const rotY = angle * 0.9;
      const rotX = Math.sin(angle*0.3)*0.15;

      for(const p of particles){
        // rotation matrices
        // rotate around Y
        const x1 = p.x*Math.cos(rotY) - p.z*Math.sin(rotY);
        const z1 = p.x*Math.sin(rotY) + p.z*Math.cos(rotY);
        // rotate around X
        const y1 = p.y*Math.cos(rotX) - z1*Math.sin(rotX);
        const z2 = p.y*Math.sin(rotX) + z1*Math.cos(rotX);

        // perspective
        const depth = (z2 + 1.5) / 2.5; // 0..1
        const px = cx + x1 * radius;
        const py = cy + y1 * radius * 0.9;

        // color & size based on depth
        const size = 1 + depth*2.6;
        const alpha = 0.25 + depth*0.85;
        ctx.beginPath();
        // color shifts: greens and blues
        const g = Math.floor(120 + depth*90);
        const b = Math.floor(160 + depth*40);
        ctx.fillStyle = `rgba(${g},${b},${180},${alpha})`;
        ctx.arc(px,py,size,0,Math.PI*2);
        ctx.fill();
      }

      // subtle equator ring
      ctx.beginPath();
      ctx.strokeStyle = "rgba(255,255,255,0.02)";
      ctx.lineWidth = 1;
      ctx.ellipse(cx,cy, radius*1.01, radius*0.92, 0, 0, Math.PI*2);
      ctx.stroke();

      angle += 0.0025;
      requestAnimationFrame(drawGlobe);
    }

    // initialize
    initParticles();
    drawGlobe();

    // ======= Planting / Trees logic =======
    function plantTree(count=1){
      state.trees += count;
      // simulate co2 saved: each tree -> 0.02 t CO2 (very simplified)
      state.co2Saved += count * 0.02;
      // peace effect: small boost per tree
      state.peaceBoost = Math.min(10, state.trees * 0.01);

      updateUI();
      spawnFloatingLeaf(count);
    }

    function updateUI(){
      treesCount.textContent = state.trees;
      co2Count.textContent = state.co2Saved.toFixed(2) + ' t';
      sideTrees.textContent = state.trees;
      sidePeace.textContent = '+' + state.peaceBoost.toFixed(2);

      // update simulated global stats slightly influenced by number of trees
      const baseForest = 34; // %
      const forest = (baseForest + Math.min(8, state.trees * 0.02)).toFixed(1);
      globalForest.textContent = forest + '%';
      forestQty.textContent = forest + '%';

      // refugees down as forest increases
      const refugees = Math.max(4, 12 - Math.floor((forest - baseForest) * 0.6));
      climateRefugee.textContent = refugees + 'M';
      refugeeQty.textContent = refugees + 'M';

      // peace index slightly increases
      const peace = Math.min(100, 72 + state.peaceBoost);
      peaceIndex.textContent = Math.round(peace);
    }

    // floating leaf animation (visual feedback)
    function spawnFloatingLeaf(n=1){
      // create ephemeral DOM element that floats upward
      for(let i=0;i<n;i++){
        const leaf = document.createElement('div');
        leaf.textContent = 'ğŸŒ±';
        leaf.style.position = 'fixed';
        const x = Math.random()*60 + 20; // % viewport
        leaf.style.left = x + 'vw';
        leaf.style.bottom = '8vh';
        leaf.style.fontSize = (12 + Math.random()*18) + 'px';
        leaf.style.opacity = '0';
        leaf.style.transition = 'transform 1.6s cubic-bezier(.2,.9,.3,1), opacity 0.6s linear';
        leaf.style.zIndex = 1200;
        document.body.appendChild(leaf);
        requestAnimationFrame(()=>{
          leaf.style.opacity = '1';
          leaf.style.transform = `translateY(-30vh) translateX(${(Math.random()-0.5)*8}vw) rotate(${Math.random()*360}deg)`;
        });
        setTimeout(()=> leaf.style.opacity = '0', 1200);
        setTimeout(()=> document.body.removeChild(leaf), 2200);
      }
    }

    // ======= Timeline Simulation =======
    function onYearChange(y){
      yearLabel.textContent = y;
      // simplistic model: forest decreases until 2035 then slight recovery if action
      let forest = 34;
      if(y < 2020) forest = 38 - (2020 - y)*0.2;
      else if (y <= 2035) forest = 34 - (y-2020)*0.35;
      else forest = 29 + Math.max(0, (y-2035)*0.15);

      // incorporate trees planted by user as improvement
      forest = Math.min(45, forest + Math.min(8, state.trees*0.02));

      const refugees = Math.max(3, Math.round((50 - forest) * 0.25));
      const peace = Math.max(30, Math.min(100, 70 + (forest-34)));

      forestQty.textContent = forest.toFixed(1) + '%';
      globalForest.textContent = forest.toFixed(1) + '%';
      refugeeQty.textContent = refugees + 'M';
      climateRefugee.textContent = refugees + 'M';
      peaceIndex.textContent = Math.round(peace);
    }

    // ======= Theme Toggle =======
    const root = document.documentElement;
    let currentTheme = localStorage.getItem('eco-theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme:light)').matches ? 'light' : 'dark');
    function applyTheme(theme){
      root.setAttribute('data-theme', theme);
      themeToggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
      localStorage.setItem('eco-theme', theme);
    }
    applyTheme(currentTheme);

    // ======= Events & Controls =======
    slider.addEventListener('input', (e)=> onYearChange(e.target.value));
    onYearChange(slider.value);

    themeToggle.addEventListener('click', ()=>{
      const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      applyTheme(next);
    });

    plantBtn.addEventListener('click', ()=> plantTree(1));
    plantQuick.addEventListener('click', ()=> plantTree(1));
    document.getElementById('start-plant').addEventListener('click', ()=> plantTree(3));
    document.getElementById('learn-more').addEventListener('click', ()=> location.href = '#stories');

    autoPlant.addEventListener('click', ()=>{
      state.autoPlanting = !state.autoPlanting;
      autoPlant.textContent = state.autoPlanting ? 'ìë™ ì‹¬ê¸° ë”' : 'ìë™ ì‹¬ê¸° ì¼œê¸°';
      if(state.autoPlanting) startAutoPlant();
    });

    let autoTimer = null;
    function startAutoPlant(){
      if(autoTimer) clearInterval(autoTimer);
      autoTimer = setInterval(()=> {
        plantTree(1);
        if(!state.autoPlanting) clearInterval(autoTimer);
      }, 1800);
    }

    fastForward.addEventListener('click', ()=>{
      slider.value = Math.min(2050, parseInt(slider.value) + 5);
      slider.dispatchEvent(new Event('input'));
    });
    resetSim.addEventListener('click', ()=>{
      slider.value = 2025;
      slider.dispatchEvent(new Event('input'));
      state.trees = 0; state.co2Saved = 0; state.peaceBoost = 0; state.autoPlanting = false;
      autoPlant.textContent = 'ìë™ ì‹¬ê¸° ì¼œê¸°';
      updateUI();
    });

    jumpAction.addEventListener('click', ()=> location.href = '#action');

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.code === 'Space'){ e.preventDefault(); plantTree(1); }
      if(e.key.toLowerCase() === 't') { const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light'; applyTheme(next); }
    });

    // clicking on canvas or elsewhere also plants
    document.getElementById('hero').addEventListener('click', (e)=>{
      // avoid clicking UI controls
      if(e.target.closest('.control') || e.target.closest('.btn')) return;
      plantTree(1);
    });

    // contact form handling (client-side)
    const contactForm = document.getElementById('contact-form');
    const sendBtn = document.getElementById('send-btn');
    const formStatus = document.getElementById('form-status');

    sendBtn.addEventListener('click', ()=>{
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const msg = document.getElementById('message').value.trim();
      if(!name || !email || !msg){ formStatus.textContent = 'ëª¨ë“  í•­ëª©ì„ ì±„ì›Œì£¼ì„¸ìš”.'; return; }
      // fake "send"
      formStatus.textContent = 'ì „ì†¡ì¤‘...';
      sendBtn.disabled = true;
      setTimeout(()=>{
        formStatus.textContent = 'ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ â€” ê³§ ì—°ë½ë“œë¦´ê²Œìš”!';
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('message').value = '';
        sendBtn.disabled = false;
      }, 900);
    });

    // small accessibility: focus highlight for story cards
    document.querySelectorAll('.story').forEach(s => s.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' ') s.style.outline = '2px solid rgba(125,211,252,0.2)';
    }));

    // IntersectionObserver for reveal animations (progressive)
    const io = new IntersectionObserver((entries)=> {
      entries.forEach(ent => {
        if(ent.isIntersecting) ent.target.style.transform = 'translateY(0)', ent.target.style.opacity = '1';
      });
    }, {threshold:0.12});
    document.querySelectorAll('main section').forEach(sec=>{
      sec.style.opacity = '0'; sec.style.transform = 'translateY(28px)'; sec.style.transition = 'opacity .8s ease, transform .8s ease';
      io.observe(sec);
    });

    // Initial UI update
    updateUI();

    // Quick safeguard: Resize canvas to devicePixelRatio for crisper rendering
    function adjustCanvasDPR(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      canvas.width = innerWidth * dpr;
      canvas.height = innerHeight * dpr;
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    adjustCanvasDPR();
    addEventListener('resize', adjustCanvasDPR);

    // Debug-check: Basic self-check to ensure key components exist
    console.assert(canvas && ctx, 'Canvas or context missing');
    console.assert(treesCount && co2Count, 'UI counters missing');

    // End of IIFE
  })();
  </script>
</body>
</html>
